# Pokemon Card Share Feature - Visual Architecture

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Pokemon Detail Screen                       â”‚
â”‚                                                                   â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—     â”‚
â”‚  â•‘  AppBar: "Charizard"                              [â†]  â•‘     â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•     â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Hero Image                                           â”‚       â”‚
â”‚  â”‚  ğŸ”¥ğŸ‰                                                 â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                   â”‚
â”‚  [Info] [Stats] [Matchups] [Evolution] [Moves] [Locations]     â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Tab Content...                                       â”‚       â”‚
â”‚  â”‚                                                        â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                   â”‚
â”‚                                           â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®      â”‚
â”‚                                           â”‚ [ğŸ“¤ Compartir]â”‚ â† FloatingActionButton
â”‚                                           â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ User taps
                                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Share Card Dialog (Preview)                         â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Compartir PokÃ©mon Card                             [âœ•]  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—            â”‚                 â”‚
â”‚  â”‚  â•‘     CHARIZARD                           â”‚ â† Preview       â”‚
â”‚  â”‚  â•‘     #006                                â”‚   (scaled)      â”‚
â”‚  â”‚  â•‘                                         â”‚                 â”‚
â”‚  â”‚  â•‘        â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®                     â”‚                 â”‚
â”‚  â”‚  â•‘        â”‚  ğŸ”¥ğŸ‰   â”‚                     â”‚                 â”‚
â”‚  â”‚  â•‘        â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯                     â”‚                 â”‚
â”‚  â”‚  â•‘                                         â”‚                 â”‚
â”‚  â”‚  â•‘   [Fire] [Flying]                      â”‚                 â”‚
â”‚  â”‚  â•‘                                         â”‚                 â”‚
â”‚  â”‚  â•‘   HP:78  ATK:84  DEF:78                â”‚                 â”‚
â”‚  â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•            â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                   â”‚
â”‚  [Cancelar]                          [ğŸ“¤ Compartir]             â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ User taps "Compartir"
                                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Processing Flow                               â”‚
â”‚                                                                   â”‚
â”‚  1. RepaintBoundary captures widget                             â”‚
â”‚     â†“                                                             â”‚
â”‚  2. RenderRepaintBoundary.toImage(pixelRatio: 3.0)             â”‚
â”‚     â†“                                                             â”‚
â”‚  3. Convert to PNG bytes (ui.Image.toByteData)                  â”‚
â”‚     â†“                                                             â”‚
â”‚  4. Get temporary directory (path_provider)                     â”‚
â”‚     â†“                                                             â”‚
â”‚  5. Save as 'pokemon_6_card.png'                                â”‚
â”‚     â†“                                                             â”‚
â”‚  6. Create XFile from path                                      â”‚
â”‚     â†“                                                             â”‚
â”‚  7. Share.shareXFiles([xFile])                                  â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ Opens native share sheet
                                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Native System Share Dialog                          â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Share "pokemon_6_card.png"                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚WhatsAppâ”‚  â”‚Instagramâ”‚  â”‚Telegramâ”‚  â”‚Messagesâ”‚               â”‚
â”‚  â”‚   ğŸ“±   â”‚  â”‚   ğŸ“·    â”‚  â”‚   âœˆï¸   â”‚  â”‚   ğŸ’¬   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  Mail  â”‚  â”‚  Files â”‚  â”‚ Dropboxâ”‚  â”‚  More  â”‚               â”‚
â”‚  â”‚   âœ‰ï¸   â”‚  â”‚   ğŸ“   â”‚  â”‚   â˜ï¸   â”‚  â”‚   ...  â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Interaction Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DetailScreen   â”‚
â”‚   (StatelessW)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ User taps FAB
         â”‚
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ _showShareDialog() â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Shows Dialog
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ _ShareCardDialog    â”‚
    â”‚  (StatefulWidget)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Contains
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   RepaintBoundary       â”‚
    â”‚   with GlobalKey        â”‚
    â”‚         â”‚               â”‚
    â”‚         â†“               â”‚
    â”‚  PokemonShareCard       â”‚
    â”‚    (Widget)             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ User taps Share
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  CardCaptureService     â”‚
    â”‚   (Service Class)       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”œâ”€â†’ captureWidget()
             â”‚   â”œâ”€ Find RenderRepaintBoundary
             â”‚   â”œâ”€ toImage(pixelRatio: 3.0)
             â”‚   â””â”€ Convert to PNG bytes
             â”‚
             â”œâ”€â†’ saveImageToTemp()
             â”‚   â”œâ”€ getTemporaryDirectory()
             â”‚   â””â”€ File.writeAsBytes()
             â”‚
             â””â”€â†’ shareImage()
                 â”œâ”€ Create XFile
                 â””â”€ Share.shareXFiles()
                     â””â”€ Opens native dialog
```

## Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pokemon Detail   â”‚ â† Input
â”‚ (PokemonDetail)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   pokemon.name    = "charizard"  â”‚
â”‚   pokemon.id      = 6             â”‚
â”‚   pokemon.imageUrl = "https://..." â”‚
â”‚   pokemon.types   = ["fire","fly"]â”‚
â”‚   pokemon.stats   = [...HP, ATK...]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Type Color Resolution       â”‚
â”‚  "fire" â†’ Color(0xFFEE8130) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PokemonShareCard Widget   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Gradient Backgroundâ”‚    â”‚
â”‚  â”‚ (based on type)    â”‚    â”‚
â”‚  â”‚                    â”‚    â”‚
â”‚  â”‚  Name: CHARIZARD   â”‚    â”‚
â”‚  â”‚  #006              â”‚    â”‚
â”‚  â”‚                    â”‚    â”‚
â”‚  â”‚  ğŸ”¥ğŸ‰ (image)     â”‚    â”‚
â”‚  â”‚                    â”‚    â”‚
â”‚  â”‚  [Fire] [Flying]   â”‚    â”‚
â”‚  â”‚                    â”‚    â”‚
â”‚  â”‚  HP ATK DEF        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  Size: 1080x1920           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“ RepaintBoundary captures
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PNG Image        â”‚
â”‚   (Uint8List)      â”‚
â”‚   ~500KB-1MB       â”‚
â”‚   3.0 pixel ratio  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“ Save to temp
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  /tmp/pokemon_6.png    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“ Share via system
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Native Share Dialog   â”‚
â”‚  User selects app      â”‚
â”‚  Image is shared       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## State Management

```
_ShareCardDialog State Lifecycle:

initState()
  â†“
  _isSharing = false
  _cardKey = GlobalKey()
  _captureService = CardCaptureService()
  â†“
build() â† User sees preview
  â†“
  User taps "Compartir"
  â†“
  _shareCard() called
    â†“
    setState(() { _isSharing = true })
    â†“
    await Future.delayed(100ms)  â† Let RepaintBoundary initialize
    â†“
    await _captureService.captureAndShare()
      â”œâ”€ Success
      â”‚   â†“
      â”‚   Navigator.pop()
      â”‚   SnackBar: "Â¡Tarjeta compartida!"
      â”‚
      â””â”€ Failure
          â†“
          SnackBar: "No se pudo compartir"
    â†“
    setState(() { _isSharing = false })
    â†“
  dispose()
```

## Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Action        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Try Capture Widget   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                 â”‚
    Success          Failure
      â”‚                 â”‚
      â†“                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Save to Tempâ”‚    â”‚DebugPrint Errorâ”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â”‚Return null     â”‚
      â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                    â”‚
      â†“                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Share    â”‚    â”‚  Show SnackBar â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â”‚  "No se pudo   â”‚
      â”‚           â”‚   compartir"   â”‚
      â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Success!  â”‚
â”‚Show SnackBarâ”‚
â”‚"Â¡Compartida!"â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## File System Layout

```
Application Directories:

/data/data/com.example.pokedex/
â”œâ”€â”€ cache/                          â† Temporary directory
â”‚   â””â”€â”€ pokemon_6_card.png         â† Generated card (auto-cleaned)
â”‚
â””â”€â”€ app_flutter/
    â””â”€â”€ (Hive databases, etc.)

After sharing, the OS handles:
- File permissions
- Transfer to destination app
- Cleanup of temp files
```

## Widget Tree

```
MaterialApp
 â””â”€ Navigator
     â””â”€ DetailScreen (StatelessWidget)
         â””â”€ Query (GraphQL)
             â””â”€ Scaffold
                 â”œâ”€ AppBar
                 â”œâ”€ Body
                 â”‚   â””â”€ RefreshIndicator
                 â”‚       â””â”€ SafeArea
                 â”‚           â””â”€ Stack
                 â”‚               â”œâ”€ PokemonDetailBody
                 â”‚               â””â”€ LinearProgressIndicator (if loading)
                 â”‚
                 â””â”€ FloatingActionButton.extended
                     â””â”€ onPressed: _showShareDialog()
                         â””â”€ showDialog()
                             â””â”€ Dialog
                                 â””â”€ _ShareCardDialog (StatefulWidget)
                                     â”œâ”€ Header (title + close button)
                                     â”œâ”€ Preview Container
                                     â”‚   â””â”€ RepaintBoundary (with _cardKey)
                                     â”‚       â””â”€ PokemonShareCard
                                     â”‚           â”œâ”€ Container (gradient)
                                     â”‚           â”œâ”€ Column
                                     â”‚           â”‚   â”œâ”€ Name + Number
                                     â”‚           â”‚   â”œâ”€ Expanded (Image)
                                     â”‚           â”‚   â””â”€ Types + Stats
                                     â”‚
                                     â””â”€ Actions Row
                                         â”œâ”€ OutlinedButton (Cancelar)
                                         â””â”€ ElevatedButton (Compartir)
```

## Timing Diagram

```
Time â†’
User                    UI                      Service              System
  â”‚                      â”‚                        â”‚                    â”‚
  â”‚  Tap "Compartir"     â”‚                        â”‚                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’                        â”‚                    â”‚
  â”‚                      â”‚                        â”‚                    â”‚
  â”‚                    Dialog                     â”‚                    â”‚
  â”‚                    Opens                      â”‚                    â”‚
  â”‚                      â”‚                        â”‚                    â”‚
  â”‚                      â”‚  RepaintBoundary       â”‚                    â”‚
  â”‚                      â”‚  renders PokemonCard   â”‚                    â”‚
  â”‚                      â”‚  (100ms)               â”‚                    â”‚
  â”‚                      â”‚                        â”‚                    â”‚
  â”‚  Tap "Compartir"     â”‚                        â”‚                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’                        â”‚                    â”‚
  â”‚                      â”‚                        â”‚                    â”‚
  â”‚                    Button                     â”‚                    â”‚
  â”‚                    disabled                   â”‚                    â”‚
  â”‚                      â”‚                        â”‚                    â”‚
  â”‚                      â”‚  captureWidget()       â”‚                    â”‚
  â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’                    â”‚
  â”‚                      â”‚                        â”‚                    â”‚
  â”‚                      â”‚                    Capture                  â”‚
  â”‚                      â”‚                   (200ms)                   â”‚
  â”‚                      â”‚                        â”‚                    â”‚
  â”‚                      â”‚  saveImageToTemp()     â”‚                    â”‚
  â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’                    â”‚
  â”‚                      â”‚                        â”‚                    â”‚
  â”‚                      â”‚                    Save File                â”‚
  â”‚                      â”‚                    (50ms)                   â”‚
  â”‚                      â”‚                        â”‚                    â”‚
  â”‚                      â”‚  shareImage()          â”‚                    â”‚
  â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’                    â”‚
  â”‚                      â”‚                        â”‚                    â”‚
  â”‚                      â”‚                        â”‚  Show Share Sheet  â”‚
  â”‚                      â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
  â”‚                      â”‚                        â”‚                    â”‚
  â”‚                    Dialog                     â”‚                Native
  â”‚                    closes                     â”‚                Dialog
  â”‚                      â”‚                        â”‚                Shows
  â”‚                      â”‚                        â”‚                    â”‚
  â”‚  Select WhatsApp     â”‚                        â”‚                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
  â”‚                      â”‚                        â”‚                    â”‚
  â”‚                      â”‚                        â”‚              Share
  â”‚                      â”‚                        â”‚             Complete
  â”‚                      â”‚                        â”‚                    â”‚
  â”‚                    Success                    â”‚                    â”‚
  â”‚                   SnackBar                    â”‚                    â”‚
  â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”‚                    â”‚
  â”‚                      â”‚                        â”‚                    â”‚

Total time: ~350-500ms (excluding user's app selection)
```

## Memory Usage

```
Memory Lifecycle:

App Launch:
  RAM: ~100MB (base app)
  
User opens DetailScreen:
  RAM: ~120MB (Pokemon images cached)
  
User opens Share Dialog:
  RAM: ~125MB (dialog + preview)
  
Capture begins:
  RAM: ~135MB (RepaintBoundary rendering)
       â†‘ +10MB for 1080x1920 RGB buffer
  
PNG encoding:
  RAM: ~140MB (temporary encoding buffer)
  
Save to disk:
  Disk: ~800KB in /tmp/
  RAM: ~125MB (encoding buffer freed)
  
Share complete:
  RAM: ~120MB (dialog closed)
  Disk: ~800KB (OS will cleanup temp files)

Peak memory: ~140MB (brief spike during encoding)
Steady state: ~120MB
```

This diagram shows the complete architecture and flow of the Pokemon Card Share feature, making it easy to understand how all components work together.
